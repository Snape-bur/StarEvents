@model IEnumerable<StarEvents.Models.Booking>

@{
    ViewData["Title"] = "Bookings";
}

<div class="p-6">
    <h1 class="text-2xl font-bold text-gray-800 mb-6">🎟️ Bookings Management</h1>

    <!-- ✅ Filter Bar -->
    <form method="get" asp-action="Index" class="mb-6 flex flex-wrap items-center gap-3">
        <select name="status"
                class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none">
            @foreach (var s in ViewBag.StatusList as List<string>)
            {
                <option value="@s" selected="@(ViewBag.SelectedStatus == s)">
                    @s
                </option>
            }
        </select>

        <select name="eventId"
                class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none">
            <option value="">All Events</option>
            @foreach (var e in ViewBag.Events)
            {
                <option value="@e.EventId" selected="@(ViewBag.SelectedEventId == e.EventId)">
                    @e.Title
                </option>
            }
        </select>

        <button type="submit"
                class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">
            Apply
        </button>

        <a asp-action="Index"
           class="text-gray-600 hover:text-blue-600 ml-2 underline text-sm">Clear</a>
    </form>

    <!-- ✅ Booking Table -->
    <div class="overflow-x-auto bg-white rounded-2xl shadow-md">
        <table class="min-w-full text-sm text-gray-700">
            <thead class="bg-blue-600 text-white">
                <tr>
                    <th class="py-3 px-4 text-left">Event Title</th>
                    <th class="py-3 px-4 text-left">Customer</th>
                    <th class="py-3 px-4 text-center">Quantity</th>
                    <th class="py-3 px-4 text-left">Total Price (฿)</th>
                    <th class="py-3 px-4 text-left">Status</th>
                    <th class="py-3 px-4 text-left">Booking Date</th>
                    <th class="py-3 px-4 text-left">QR Ticket</th>
                    <th class="py-3 px-4 text-center">Actions</th>
                </tr>
            </thead>

            <tbody class="divide-y divide-gray-100">
                @foreach (var item in Model)
                {
                    <tr class="hover:bg-gray-50 transition">
                        <td class="py-3 px-4 font-medium">@item.Event?.Title</td>
                        <td class="py-3 px-4">@item.Customer?.FullName</td>
                        <td class="py-3 px-4 text-center">@item.Quantity</td>
                        <td class="py-3 px-4">@item.TotalPrice.ToString("N2")</td>
                        <td class="py-3 px-4">
                            @if (item.Status == "Paid")
                            {
                                <span class="px-3 py-1 bg-green-100 text-green-700 text-xs font-semibold rounded-full">Paid</span>
                            }
                            else if (item.Status == "Cancelled")
                            {
                                <span class="px-3 py-1 bg-red-100 text-red-700 text-xs font-semibold rounded-full">Cancelled</span>
                            }
                            else
                            {
                                <span class="px-3 py-1 bg-yellow-100 text-yellow-700 text-xs font-semibold rounded-full">Pending</span>
                            }
                        </td>
                        <td class="py-3 px-4">@item.BookingDate.ToString("dd MMM yyyy, HH:mm")</td>
                        <td class="py-3 px-4">
                            @if (!string.IsNullOrEmpty(item.QRCodePath))
                            {
                                <a href="@Url.Content(item.QRCodePath)" target="_blank" class="text-blue-600 hover:underline">View QR</a>
                            }
                            else
                            {
                                <span class="text-gray-400 text-sm">—</span>
                            }
                        </td>
                        <td class="py-3 px-4 text-center">
                            <a asp-action="Details" asp-route-id="@item.BookingId"
                               class="text-blue-600 hover:underline">Details</a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>

        <!-- PAGINATION -->
        <div class="flex items-center justify-center gap-3 mt-6">

            @if (ViewBag.CurrentPage > 1)
            {
                <a asp-action="Index"
                   asp-route-page="@(ViewBag.CurrentPage - 1)"
                   asp-route-status="@ViewBag.SelectedStatus"
                   asp-route-eventId="@ViewBag.SelectedEventId"
                   class="px-4 py-2 bg-gray-200 rounded-xl hover:bg-gray-300 text-sm">
                    ← Previous
                </a>
            }

            <span class="px-4 py-2 text-gray-700 font-medium text-sm">
                Page @ViewBag.CurrentPage of @ViewBag.TotalPages
            </span>

            @if (ViewBag.CurrentPage < ViewBag.TotalPages)
            {
                <a asp-action="Index"
                   asp-route-page="@(ViewBag.CurrentPage + 1)"
                   asp-route-status="@ViewBag.SelectedStatus"
                   asp-route-eventId="@ViewBag.SelectedEventId"
                   class="px-4 py-2 bg-gray-200 rounded-xl hover:bg-gray-300 text-sm">
                    Next →
                </a>
            }

        </div>

    </div>
</div>

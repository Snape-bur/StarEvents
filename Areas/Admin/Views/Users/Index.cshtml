@model IEnumerable<StarEvents.Models.AppUser>
@{
    ViewData["Title"] = "User Management";
    var userRoles = ViewBag.UserRoles as Dictionary<string, string>;
}

<div class="p-6">
    <h1 class="text-2xl font-bold text-gray-800 mb-6">👥 User Management</h1>

    <!-- ✅ Filter & Button Bar -->
    <div class="flex flex-wrap items-center justify-between mb-6">
        <!-- Left: Filter Form -->
        <form method="get" asp-action="Index" class="flex items-center gap-3">
            <select name="role"
                    class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                <option value="All">All Roles</option>
                @foreach (var r in ViewBag.Roles)
                {
                    <option value="@r" selected="@(ViewBag.SelectedRole == r)">
                        @r
                    </option>
                }
            </select>

            <button type="submit"
                    class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">
                Apply
            </button>

            <a asp-action="Index"
               class="text-gray-600 hover:text-blue-600 ml-2 underline text-sm">
                Clear
            </a>
        </form>

        <!-- Right: Create Button -->
        <a asp-area="Admin" asp-controller="Users" asp-action="Create"
           class="bg-blue-600 text-white font-semibold px-5 py-2 rounded-lg shadow hover:bg-blue-700 transition">
            + Create Admin
        </a>
    </div>


    <!-- ✅ Table -->
    <div class="overflow-x-auto bg-white rounded-2xl shadow-md">
        <table class="min-w-full text-sm text-gray-700">
            <thead class="bg-blue-600 text-white">
                <tr>
                    <th class="py-3 px-4 text-left">Full Name</th>
                    <th class="py-3 px-4 text-left">Email</th>
                    <th class="py-3 px-4 text-left">Role</th>
                    <th class="py-3 px-4 text-center">Status</th>
                    <th class="py-3 px-4 text-center">Actions</th>
                </tr>
            </thead>

            <tbody class="divide-y divide-gray-100">
                @foreach (var user in Model)
                {
                    var role = userRoles[user.Id];
                    bool isLocked = user.LockoutEnd != null && user.LockoutEnd > DateTime.UtcNow;

                    <tr class="hover:bg-gray-50 transition">
                        <td class="py-3 px-4 font-medium">@user.FullName</td>
                        <td class="py-3 px-4">@user.Email</td>
                        <td class="py-3 px-4">@role</td>
                        <td class="py-3 px-4 text-center">
                            @if (isLocked)
                            {
                                <span class="px-3 py-1 bg-red-100 text-red-700 text-xs font-semibold rounded-full">Locked</span>
                            }
                            else
                            {
                                <span class="px-3 py-1 bg-green-100 text-green-700 text-xs font-semibold rounded-full">Active</span>
                            }
                        </td>
                        <td class="py-3 px-4 text-center space-x-2">
                            <form asp-action="ToggleLock" method="post" asp-route-id="@user.Id" class="inline">
                                <button type="submit"
                                        class="text-sm bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600">
                                    @(isLocked ? "Unlock" : "Lock")
                                </button>
                            </form>
                            <form asp-action="Delete" method="post" asp-route-id="@user.Id" class="inline"
                                  onsubmit="return confirm('Are you sure you want to delete this user?');">
                                <button type="submit"
                                        class="text-sm bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700">
                                    Delete
                                </button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

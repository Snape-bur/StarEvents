@model StarEvents.Models.Event

@{
    ViewData["Title"] = "Event Details";

    // Load active discount (global admin discount)
    var discount = Model.Discounts?
        .FirstOrDefault(d =>
            d.IsActive &&
            d.StartDate <= DateTime.UtcNow &&
            d.EndDate >= DateTime.UtcNow
        );

    decimal originalPrice = Model.TicketPrice;
    decimal finalPrice = originalPrice;
    decimal savedAmount = 0;

    if (discount != null)
    {
        finalPrice = originalPrice - (originalPrice * discount.Percentage / 100);
        savedAmount = originalPrice - finalPrice;
    }
}

<div class="max-w-4xl mx-auto mt-12 bg-white rounded-3xl shadow-xl ring-1 ring-gray-200 overflow-hidden">

    <!-- Header Banner -->
    <div class="relative bg-gradient-to-r from-primary-600 to-primary-500 text-white px-8 py-6">

        <!-- 🔥 Discount Badge -->
        @if (discount != null)
        {
            <span class="absolute top-4 right-4 bg-red-600 text-white text-xs font-bold
                             px-3 py-1 rounded-full shadow">
                @discount.Percentage% OFF
            </span>
        }

        <h1 class="text-3xl font-extrabold tracking-tight">@Model.Title</h1>
        <p class="mt-1 text-sm text-primary-100">Explore event details and reserve your seat</p>
    </div>

    <!-- Main Content -->
    <div class="p-8 space-y-6 text-gray-800">

        <!-- Description -->
        <p class="text-gray-700 leading-relaxed">
            @Model.Description
        </p>

        <!-- Event Info Grid -->
        <dl class="grid sm:grid-cols-2 gap-6 text-sm">

            <div class="space-y-1">
                <dt class="text-xs uppercase font-semibold text-gray-500 tracking-wider">Category</dt>
                <dd class="font-medium text-gray-900">@Model.Category?.Name</dd>
            </div>

            <div class="space-y-1">
                <dt class="text-xs uppercase font-semibold text-gray-500 tracking-wider">Venue</dt>
                <dd class="font-medium text-gray-900">@Model.Venue?.Name — @Model.Venue?.Location</dd>
            </div>

            <div class="space-y-1">
                <dt class="text-xs uppercase font-semibold text-gray-500 tracking-wider">Date</dt>
                <dd class="font-medium text-gray-900">
                    @Model.StartDate.ToString("MMM dd, yyyy hh:mm tt")
                    —
                    @Model.EndDate.ToString("MMM dd, yyyy hh:mm tt")
                </dd>
            </div>

            <!-- Pricing Section -->
            <div class="space-y-1">
                <dt class="text-xs uppercase font-semibold text-gray-500 tracking-wider">Ticket Price</dt>

                @if (discount == null)
                {
                    <!-- Normal Price -->
                    <dd class="text-primary-600 font-semibold text-lg">
                        $@originalPrice.ToString("0.00")
                    </dd>
                }
                else
                {
                    <!-- Discounted Price -->
                    <dd class="text-lg font-extrabold text-red-600">
                        $@finalPrice.ToString("0.00")
                    </dd>

                    <dd class="line-through text-gray-500 text-sm">
                        $@originalPrice.ToString("0.00")
                    </dd>

                    <dd class="text-green-600 text-sm font-medium">
                        You save $@savedAmount.ToString("0.00")
                    </dd>
                }
            </div>

            <div class="space-y-1">
                <dt class="text-xs uppercase font-semibold text-gray-500 tracking-wider">Available Seats</dt>
                <dd class="font-medium">
                    <span class="text-green-600">@Model.AvailableSeats</span>
                    <span class="text-gray-600"> / @Model.TotalSeats</span>
                </dd>
            </div>
        </dl>

        <!-- Footer Buttons -->
        <div class="flex justify-between items-center pt-6 border-t border-gray-200">

            <a asp-action="Index"
               class="text-gray-600 hover:text-primary-600 text-sm font-medium flex items-center gap-1 transition">
                ← Back to Events
            </a>

            <form asp-area="Customer"
                  asp-controller="Booking"
                  asp-action="CheckoutPage"
                  method="get"
                  class="flex items-center gap-2">

                <input type="hidden" name="eventId" value="@Model.EventId" />

                <button type="submit"
                        class="bg-primary-600 hover:bg-primary-700 text-white font-semibold px-6 py-2.5
                   rounded-xl shadow-md shadow-primary-600/30 transition active:scale-[0.97]">
                    Book Now
                </button>
            </form>



        </div>

    </div>
</div>
